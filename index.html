<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ข้อตกลงเงื่อนไข</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body {
      font-family: "Prompt", sans-serif;
      background: url('https://www.revechat.com/wp-content/uploads/2021/05/Best-Chatbot-for-Customer-Service.webp');
      line-height: 1.6;
      color: #333;
      margin: 0;
      padding: 100px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 50vh;
    }

    .card {
      background: #fff;
      border-radius: 20px;
      border-color: #ff3c00;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      max-width: 700px;
      width: 100%;
      padding: 25px 35px;
      animation: fadeIn 0.8s ease-in-out;
    }

    h1, h2, h3 {
        color: #4a00e0;
    }
    h1 {
        text-align: center;
        margin-bottom: 20px;
        font-size: 2.5em;
    }
    h2 {
        border-bottom: 2px solid #0056b3;
        padding-bottom: 5px;
        margin-top: 40px;
        font-size: 1.8em;
    }
    h3 {
        color: #2a7e7e;
        margin-top: 25px;
        font-size: 1.4em;
    }
    ul, ol {
        margin: 15px 0;
        padding-left: 20px;
    }
    li {
        margin-bottom: 8px;
    }
    strong {
        color: #0056b3;
    }
    .disclaimer {
        background-color: #f8d7da;
        border-left: 5px solid #dc3545;
        padding: 15px;
        margin-top: 20px;
        font-style: italic;
        color: #721c24;
    }
    .contact-info {
        background-color: #e9ecef;
        padding: 20px;
        border-radius: 5px;
        margin-top: 40px;
    }
    .contact-info h3 {
        color: #495057;
        margin-top: 0;
    }
    .terms-box {
      height: 300px;
      overflow-y: auto;
      border-radius: 15px;
      background: #f9f9ff;
      border: 1px solid #ddd;
      padding: 15px 20px;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    input[type="checkbox"] {
      margin-right: 10px;
      transform: scale(1.2);
    }

    .actions {
      text-align: center;
      margin-top: 20px;
    }

    button {
      background: linear-gradient(90deg, #4a00e0, #8e2de2);
      border: none;
      color: white;
      font-size: 16px;
      padding: 12px 30px;
      border-radius: 25px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px);}
      to { opacity: 1; transform: translateY(0);}
    }
  </style>
</head>
<body>
  <div class="card">
  <h1>ข้อตกลงเงื่อนไขการใช้งาน "Botlight 7"</h1>
  <div class="terms-box">
    <p>Botlight 7 คือแชทบอทปัญญาประดิษฐ์ที่พัฒนาขึ้นเพื่อสนับสนุนการดูแลสุขภาพจิต 6 ด้าน ได้แก่ <strong>การรับรู้และเข้าใจตนเอง, การจัดการอารมณ์, ความสัมพันธ์ระหว่างบุคคล, การคิดวิเคราะห์และแก้ปัญหา, การตั้งเป้าหมายชีวิต, และการใช้ศักยภาพของตนเองอย่างเต็มที่</strong></p>

    <p>แชทบอทนี้เป็นผลงานความร่วมมือของนักศึกษาพยาบาลศาสตร์บัณฑิต ชั้นปีที่ 3 ภายใต้การสนับสนุนของอาจารย์จริญญา แก้วสกุลทอง คณะพยาบาลศาสตร์ สาขาวิชาการพยาบาลสุขภาพจิตและจิตเวช วิทยาลัยพยาบาลบรมราชชนนี สุราษฎร์ธานี โดยมีจุดประสงค์หลักเพื่อให้นักศึกษาพยาบาลสามารถประเมินและดูแลสุขภาพจิตเบื้องต้นด้วยตนเอง</p>

    <h2>ขอบเขตการให้บริการ</h2>
    <p><strong>Botlight 7</strong> ถูกออกแบบมาเพื่อเป็นเครื่องมือสนับสนุนการดูแลสุขภาพจิตในระดับเบื้องต้น <strong>ไม่ใช่เครื่องมือทางการแพทย์สำหรับวินิจฉัยหรือรักษาอาการป่วยทางจิต</strong> ข้อมูลที่ได้รับจากการสนทนาไม่สามารถใช้ทดแทนการประเมินโดยแพทย์หรือแบบคัดกรองมาตรฐานได้</p>
    <div class="disclaimer">
        <p>หากคุณกำลังเผชิญกับภาวะฉุกเฉินทางจิต เช่น มีความคิดที่จะทำร้ายตัวเองหรือผู้อื่น, มีอารมณ์ที่รุนแรงจนควบคุมไม่ได้, หรือมีอาการที่เป็นอันตรายถึงชีวิต <strong>โปรดหยุดใช้งาน Botlight 7 ทันที</strong> และติดต่อหน่วยงานช่วยเหลือฉุกเฉินโดยเร่งด่วน</p>
        <ul>
            <li><strong>สายด่วนสุขภาพจิต 1323</strong></li>
            <li><strong>สายด่วนสมาคมสะมาริตันส์ (02) 713 6793</strong></li>
            <li><strong>สถาบันการแพทย์ฉุกเฉินแห่งชาติ 1669</strong></li>
        </ul>
    </div>

    <h2>นโยบายความเป็นส่วนตัวและการเก็บรักษาข้อมูล</h2>
    <p>เราให้ความสำคัญกับการปกป้องข้อมูลส่วนบุคคลของคุณอย่างสูงสุด</p>
    <ul>
        <li><strong>การปกป้องข้อมูล:</strong> ข้อมูลการใช้งานของคุณจะถูกเก็บรวบรวมในรูปแบบที่ไม่สามารถระบุตัวตนได้ (Non-attributable) และจะไม่มีการระบุชื่อ, นามสกุล, หรือข้อมูลอื่นใดที่สามารถเชื่อมโยงกลับมาหาคุณได้โดยตรง</li>
        <li><strong>การนำข้อมูลไปใช้:</strong> ข้อมูลบางส่วน เช่น เพศ, อายุ, สถานะภาพ, และระดับการศึกษา จะถูกนำไปใช้เพื่อวัตถุประสงค์ต่อไปนี้:
            <ul>
                <li>รายงานผลภาพรวมของผู้ใช้งาน</li>
                <li>ปรับปรุงคุณภาพของ Botlight 7 ให้เหมาะสมกับผู้ใช้งานแต่ละกลุ่ม</li>
                <li>การทำวิจัยและการขอทุน (ในรูปแบบที่ไม่ระบุตัวตน)</li>
            </ul>
        </li>
        <li><strong>การรักษาความลับ:</strong> เราจะเก็บรักษาเรื่องราวและการสนทนาของคุณไว้เป็นความลับ และจะไม่เปิดเผยรายละเอียดส่วนบุคคล</li>
    </ul>
    <p>หากมีความจำเป็นต้องใช้ข้อมูลนอกเหนือจากที่ระบุไว้ข้างต้นเพื่อการทำวิจัยหรือตามคำสั่งศาล เราจะแจ้งให้คุณทราบและขอความยินยอมก่อนเสมอ</p>

    <h2>ข้อกำหนดและเงื่อนไขการใช้งาน</h2>
    <p>การใช้งาน Botlight 7 ถือว่าคุณได้อ่านและยอมรับเงื่อนไขต่อไปนี้:</p>
    <ul>
        <li><strong>ขอบเขตของผลลัพธ์:</strong> Botlight 7 สามารถให้ประโยชน์ในการดูแลสุขภาพจิตเบื้องต้นได้ แต่ทีมผู้พัฒนาไม่สามารถรับรองผลลัพธ์ที่แน่นอนจากการใช้งานได้</li>
        <li><strong>ข้อจำกัดทางเทคนิค:</strong> Botlight 7 เป็นระบบปัญญาประดิษฐ์ที่ทำงานอัตโนมัติ การโต้ตอบจึงอาจไม่เทียบเท่าการพูดคุยกับมนุษย์หรือผู้เชี่ยวชาญจริง และอาจมีปัญหาทางเทคนิคหรือความล่าช้าเกิดขึ้นได้</li>
        <li><strong>การยอมรับความเสี่ยง:</strong> การใช้งาน Botlight 7 ต่อจากนี้แสดงว่าคุณเข้าใจและยอมรับข้อจำกัดและความเสี่ยงที่อาจเกิดขึ้นได้แล้ว</li>
    </ul>

    <h2>ลิขสิทธิ์และทรัพย์สินทางปัญญา</h2>
    <p>ทีมผู้พัฒนาสงวนสิทธิ์ในเนื้อหา, รูปแบบ, และการพัฒนาทั้งหมดของ Botlight 7 ไม่อนุญาตให้มีการทำซ้ำ, ดัดแปลง, หรือนำไปใช้เพื่อประโยชน์เชิงพาณิชย์ใดๆ เว้นแต่จะได้รับอนุญาตเป็นลายลักษณ์อักษรจากทีมผู้พัฒนา</p>

    <div class="contact-info">
        <h3>การติดต่อสอบถาม</h3>
        <p>หากมีข้อสงสัย, ข้อเสนอแนะ, หรือต้องการสอบถามข้อมูลเพิ่มเติม สามารถติดต่อทีมผู้พัฒนาได้ที่:</p>
        <ul>
            <li><strong>วิทยาลัยพยาบาลบรมราชชนนี สุราษฎร์ธานี</strong></li>
            <li><strong>โทรศัพท์:</strong> 098-041-1215</li>
            <li><strong>อีเมล:</strong> AEX20656@gmail.com</li>
        </ul>
</div>
  <input type="checkbox" id="agree"> ฉันได้อ่านและยอมรับเงื่อนไข<br><br>
  <button onclick="accept()">ยอมรับเงื่อนไข</button>
  <button onclick="liff.closeWindow()">ทดสอบปิดหน้าต่าง</button>
</div>

<script>
// เริ่ม init ตอนโหลดหน้า
window.onload = async function () {
  try {
    await liff.init({ liffId: "2008068059-RwZVbkn9" });

    // ถ้ายังไม่ได้ login ให้ login
    if (!liff.isLoggedIn()) {
      liff.login();
    }
  } catch (err) {
    console.error("LIFF init error:", err);
    alert("⚠️ ไม่สามารถเชื่อมต่อ LIFF ได้");
  }
};

async function accept() {
  if (!document.getElementById("agree").checked) {
    alert("กรุณาทำเครื่องหมายเพื่อยืนยันการยอมรับ");
    return;
  }

  try {
    // ดึง profile
    const profile = await liff.getProfile();

    // userId เอาจาก decodedIDToken ถ้า login ผ่าน LINE Login
    // แต่ถ้าเปิดใน OA context ให้ใช้ liff.getContext().userId
    let userId = "";
    if (liff.getContext() && liff.getContext().userId) {
      userId = liff.getContext().userId;
    } else {
      const decodedID = liff.getDecodedIDToken();
      userId = decodedID ? decodedID.sub : "";
    }

    const payload = {
      name: profile.displayName,
      userId: userId
    };

    // ส่งไป Google Sheets
    const response = await fetch("https://script.google.com/macros/s/AKfycbyO4i_BrJ1-lAAkjasWQ11MA_rn9_Kf891aUUO-kCjpNKuE7q7eoIgkBcXUIAzvVl7n/exec", {
      method: "POST",
      headers: { 
        "Content-Type": "application/json",
        "Accept": "application/json"
      },
      body: JSON.stringify(payload),
      mode: 'no-cors'
    });

    const text = await response.text();
    console.log("GAS raw response:", text);

    let data;
    try {
      data = JSON.parse(text);
    } catch (e) {
      console.error("Response ไม่ใช่ JSON:", e);
      alert("❌ GAS ส่งข้อมูลไม่ถูกต้อง: " + text);
      return;
    }

    if (data.status === "success") {
      try {
        if (liff.isInClient()) {
          await liff.sendMessages([{
            type: "text",
            text: "✅ คุณได้ยอมรับเงื่อนไขเรียบร้อยแล้ว"
          }]);
          liff.closeWindow(); // ปิดเฉพาะใน LINE OA
        } else {
          alert("✅ บันทึกสำเร็จ (แต่คุณเปิดใน browser ธรรมดา จึงไม่สามารถปิดอัตโนมัติได้)");
        }
      } catch (e) {
        console.warn("ส่งข้อความไม่สำเร็จ:", e);
      }
    } else {
      alert("❌ ไม่สามารถบันทึกข้อมูลได้");
    }
  } catch (err) {
    console.error("เกิดข้อผิดพลาด:", err);
    alert("⚠️ มีปัญหาในการเชื่อมต่อ กรุณาลองใหม่อีกครั้ง");
  }
}

</script>

</body>
</html>
